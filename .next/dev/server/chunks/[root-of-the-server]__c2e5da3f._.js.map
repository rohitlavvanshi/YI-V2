{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Desktop/Rohit%20Workspace/Product-%20YI/supabase-saas/src/lib/supabase/admin.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js';\r\n\r\nexport const supabaseAdmin = createClient(\r\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n  process.env.SUPABASE_SERVICE_ROLE_KEY!\r\n);\r\n"],"names":[],"mappings":";;;;AAAA;;AAEO,MAAM,gBAAgB,IAAA,gMAAY,gFAEvC,QAAQ,GAAG,CAAC,yBAAyB"}},
    {"offset": {"line": 57, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Desktop/Rohit%20Workspace/Product-%20YI/supabase-saas/src/lib/llm/callLLM.ts"],"sourcesContent":["import OpenAI from 'openai';\r\n\r\nconst client = new OpenAI({\r\n  apiKey: process.env.OPENAI_API_KEY!,\r\n});\r\n\r\nexport async function callLLM(prompt: string): Promise<string> {\r\n  const res = await client.chat.completions.create({\r\n    model: 'gpt-4.1',\r\n    messages: [{ role: 'user', content: prompt }],\r\n    temperature: 0.3,\r\n  });\r\n\r\n  return res.choices[0].message.content || '';\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;AAEA,MAAM,SAAS,IAAI,OAAO;IACxB,QAAQ,QAAQ,GAAG,CAAC,cAAc;AACpC;AAEO,eAAe,QAAQ,MAAc;IAC1C,MAAM,MAAM,MAAM,OAAO,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC;QAC/C,OAAO;QACP,UAAU;YAAC;gBAAE,MAAM;gBAAQ,SAAS;YAAO;SAAE;QAC7C,aAAa;IACf;IAEA,OAAO,IAAI,OAAO,CAAC,EAAE,CAAC,OAAO,CAAC,OAAO,IAAI;AAC3C"}},
    {"offset": {"line": 87, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Desktop/Rohit%20Workspace/Product-%20YI/supabase-saas/src/lib/research/queryGenerator.ts"],"sourcesContent":["import { callLLM } from '@/lib/llm/callLLM';\r\nimport { loadPrompts } from '@/lib/prompts/loadPrompts';\r\nimport { QUERY_GENERATION_SCHEMA } from '@/lib/prompts/schemas';\r\n\r\nconst EXPECTED_COUNT = 12;\r\n\r\ntype GenerateQueryArgs = {\r\n  companyContext: string;\r\n  metric: string;\r\n  driver: string;\r\n};\r\n\r\nexport async function generateQueriesForDriver({\r\n  companyContext,\r\n  metric,\r\n  driver,\r\n}: GenerateQueryArgs): Promise<string[]> {\r\n  const prompts = loadPrompts();\r\n  const instructions = prompts.PROMPT_BUILDER_INSTRUCTIONS;\r\n\r\n  const prompt = `\r\n${instructions}\r\n\r\nYou are generating SEARCH QUERIES for an AI search engine (Brave).\r\n\r\nEach query MUST describe a REAL-WORLD EXTERNAL EVENT.\r\n\r\nSTRICT RULES:\r\n- Generate EXACTLY ${EXPECTED_COUNT} queries\r\n- Each query must be 10‚Äì15 words\r\n- Mention REAL companies, operators, facilities, or infrastructure\r\n- Focus on EXTERNAL signals only\r\n- No placeholders\r\n- No numbering\r\n- No explanations\r\n- No generic language\r\n\r\nCompany Context:\r\n${companyContext}\r\n\r\nMetric:\r\n${metric}\r\n\r\nDriver:\r\n${driver}\r\n\r\nOUTPUT FORMAT (STRICT JSON ONLY):\r\n${QUERY_GENERATION_SCHEMA}\r\n`.trim();\r\n\r\n  const raw = await callLLM(prompt);\r\n\r\n  let parsed: any;\r\n  try {\r\n    parsed = JSON.parse(raw);\r\n  } catch {\r\n    throw new Error('Query generation failed: invalid JSON');\r\n  }\r\n\r\n  const queries = Array.isArray(parsed?.queries)\r\n    ? parsed.queries\r\n    : [];\r\n\r\n  const cleaned = queries\r\n    .filter((q: any) => typeof q === 'string')\r\n    .map((q: string) => q.trim())\r\n    .filter((q: string) => q.split(' ').length >= 10);\r\n\r\n  if (cleaned.length !== EXPECTED_COUNT) {\r\n    throw new Error(\r\n      `Query generation failed: expected ${EXPECTED_COUNT}, got ${cleaned.length}`\r\n    );\r\n  }\r\n\r\n  return cleaned;\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;;;;;;;;;;;;;AAIA,MAAM,iBAAiB;AAQhB,eAAe,yBAAyB,EAC7C,cAAc,EACd,MAAM,EACN,MAAM,EACY;IAClB,MAAM,UAAU;IAChB,MAAM,eAAe,QAAQ,2BAA2B;IAExD,MAAM,SAAS,CAAC;AAClB,EAAE,aAAa;;;;;;;mBAOI,EAAE,eAAe;;;;;;;;;;AAUpC,EAAE,eAAe;;;AAGjB,EAAE,OAAO;;;AAGT,EAAE,OAAO;;;AAGT,EAAE,wBAAwB;AAC1B,CAAC,CAAC,IAAI;IAEJ,MAAM,MAAM,MAAM,IAAA,yIAAO,EAAC;IAE1B,IAAI;IACJ,IAAI;QACF,SAAS,KAAK,KAAK,CAAC;IACtB,EAAE,OAAM;QACN,MAAM,IAAI,MAAM;IAClB;IAEA,MAAM,UAAU,MAAM,OAAO,CAAC,QAAQ,WAClC,OAAO,OAAO,GACd,EAAE;IAEN,MAAM,UAAU,QACb,MAAM,CAAC,CAAC,IAAW,OAAO,MAAM,UAChC,GAAG,CAAC,CAAC,IAAc,EAAE,IAAI,IACzB,MAAM,CAAC,CAAC,IAAc,EAAE,KAAK,CAAC,KAAK,MAAM,IAAI;IAEhD,IAAI,QAAQ,MAAM,KAAK,gBAAgB;QACrC,MAAM,IAAI,MACR,CAAC,kCAAkC,EAAE,eAAe,MAAM,EAAE,QAAQ,MAAM,EAAE;IAEhF;IAEA,OAAO;AACT"}},
    {"offset": {"line": 156, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Desktop/Rohit%20Workspace/Product-%20YI/supabase-saas/src/lib/research/startCompanyResearch.ts"],"sourcesContent":["import { generateQueriesForDriver } from './queryGenerator';\r\n\r\ntype StartResearchArgs = {\r\n  companyId: number;\r\n  companyContext: string;\r\n  drivers: string[];\r\n  metric: string;\r\n};\r\n\r\nexport async function startCompanyResearch({\r\n  companyId,\r\n  companyContext,\r\n  drivers,\r\n  metric,\r\n}: StartResearchArgs) {\r\n  const result: Record<string, string[]> = {};\r\n\r\n  for (const driver of drivers) {\r\n    const queries = await generateQueriesForDriver({\r\n      companyContext,\r\n      metric,\r\n      driver,\r\n    });\r\n\r\n    result[driver] = queries;\r\n  }\r\n\r\n  // üîå INTEGRATE WITH YOUR EXISTING PIPELINE HERE\r\n  // Examples:\r\n  // - save to DB\r\n  // - enqueue to worker\r\n  // - trigger search jobs\r\n\r\n  return {\r\n    companyId,\r\n    queries: result,\r\n  };\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AASO,eAAe,qBAAqB,EACzC,SAAS,EACT,cAAc,EACd,OAAO,EACP,MAAM,EACY;IAClB,MAAM,SAAmC,CAAC;IAE1C,KAAK,MAAM,UAAU,QAAS;QAC5B,MAAM,UAAU,MAAM,IAAA,sKAAwB,EAAC;YAC7C;YACA;YACA;QACF;QAEA,MAAM,CAAC,OAAO,GAAG;IACnB;IAEA,gDAAgD;IAChD,YAAY;IACZ,eAAe;IACf,sBAAsB;IACtB,wBAAwB;IAExB,OAAO;QACL;QACA,SAAS;IACX;AACF"}},
    {"offset": {"line": 186, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Desktop/Rohit%20Workspace/Product-%20YI/supabase-saas/src/app/api/manager/companies/%5Bid%5D/start-research/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport { supabaseAdmin } from '@/lib/supabase/admin';\r\nimport { startCompanyResearch } from '@/lib/research/startCompanyResearch';\r\n\r\nexport async function POST(\r\n  _req: Request,\r\n  context: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    const { id } = await context.params;\r\n    const companyId = Number(id);\r\n\r\n    if (!companyId) {\r\n      return NextResponse.json(\r\n        { error: 'Invalid company ID' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // 1Ô∏è‚É£ Fetch company context\r\n    const { data: company } = await supabaseAdmin\r\n      .from('companies')\r\n      .select('company_context')\r\n      .eq('id', companyId)\r\n      .single();\r\n\r\n    // 2Ô∏è‚É£ Fetch drivers\r\n    const { data: driversData } = await supabaseAdmin\r\n      .from('drivers')\r\n      .select('driver')\r\n      .eq('company_id', companyId);\r\n\r\n    if (!company || !driversData?.length) {\r\n      return NextResponse.json(\r\n        { error: 'Company context or drivers missing' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // 3Ô∏è‚É£ Start research\r\n    await startCompanyResearch({\r\n      companyId,\r\n      companyContext: company.company_context,\r\n      drivers: driversData.map((d) => d.driver),\r\n      metric: 'Revenue Growth', // üîÅ make dynamic later if needed\r\n    });\r\n\r\n    return NextResponse.json({ success: true });\r\n  } catch (err: any) {\r\n    return NextResponse.json(\r\n      { error: err.message || 'Failed to start research' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEO,eAAe,KACpB,IAAa,EACb,OAA4C;IAE5C,IAAI;QACF,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM,QAAQ,MAAM;QACnC,MAAM,YAAY,OAAO;QAEzB,IAAI,CAAC,WAAW;YACd,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAqB,GAC9B;gBAAE,QAAQ;YAAI;QAElB;QAEA,4BAA4B;QAC5B,MAAM,EAAE,MAAM,OAAO,EAAE,GAAG,MAAM,kJAAa,CAC1C,IAAI,CAAC,aACL,MAAM,CAAC,mBACP,EAAE,CAAC,MAAM,WACT,MAAM;QAET,oBAAoB;QACpB,MAAM,EAAE,MAAM,WAAW,EAAE,GAAG,MAAM,kJAAa,CAC9C,IAAI,CAAC,WACL,MAAM,CAAC,UACP,EAAE,CAAC,cAAc;QAEpB,IAAI,CAAC,WAAW,CAAC,aAAa,QAAQ;YACpC,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAqC,GAC9C;gBAAE,QAAQ;YAAI;QAElB;QAEA,qBAAqB;QACrB,MAAM,IAAA,wKAAoB,EAAC;YACzB;YACA,gBAAgB,QAAQ,eAAe;YACvC,SAAS,YAAY,GAAG,CAAC,CAAC,IAAM,EAAE,MAAM;YACxC,QAAQ;QACV;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAK;IAC3C,EAAE,OAAO,KAAU;QACjB,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO,IAAI,OAAO,IAAI;QAA2B,GACnD;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}