{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Desktop/Rohit%20Workspace/Product-%20YI/supabase-saas/src/lib/supabase/admin.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js';\r\n\r\nexport const supabaseAdmin = createClient(\r\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n  process.env.SUPABASE_SERVICE_ROLE_KEY!\r\n);\r\n"],"names":[],"mappings":";;;;AAAA;;AAEO,MAAM,gBAAgB,IAAA,gMAAY,gFAEvC,QAAQ,GAAG,CAAC,yBAAyB"}},
    {"offset": {"line": 57, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Desktop/Rohit%20Workspace/Product-%20YI/supabase-saas/src/app/api/manager/companies/%5Bid%5D/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport { supabaseAdmin } from '@/lib/supabase/admin';\r\n\r\n/**\r\n * GET company context + drivers\r\n */\r\nexport async function GET(\r\n  _req: Request,\r\n  context: { params: Promise<{ id: string }> }\r\n) {\r\n  const { id } = await context.params; // ✅ FIX\r\n  const companyId = Number(id);\r\n\r\n  if (!companyId) {\r\n    return NextResponse.json(\r\n      { error: 'Invalid company ID' },\r\n      { status: 400 }\r\n    );\r\n  }\r\n\r\n  // 1️⃣ Fetch company\r\n  const { data: company, error: companyError } =\r\n    await supabaseAdmin\r\n      .from('companies')\r\n      .select('id, company_context')\r\n      .eq('id', companyId)\r\n      .single();\r\n\r\n  if (companyError) {\r\n    return NextResponse.json(\r\n      { error: companyError.message },\r\n      { status: 500 }\r\n    );\r\n  }\r\n\r\n  // 2️⃣ Fetch drivers\r\n  const { data: drivers, error: driversError } =\r\n    await supabaseAdmin\r\n      .from('drivers')\r\n      .select('id, driver')\r\n      .eq('company_id', companyId);\r\n\r\n  if (driversError) {\r\n    return NextResponse.json(\r\n      { error: driversError.message },\r\n      { status: 500 }\r\n    );\r\n  }\r\n\r\n  return NextResponse.json({\r\n    company,\r\n    drivers,\r\n  });\r\n}\r\n\r\n/**\r\n * UPDATE company context + drivers\r\n */\r\nexport async function PUT(\r\n  req: Request,\r\n  context: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    const { id } = await context.params; // ✅ FIX\r\n    const companyId = Number(id);\r\n    const { company_context, drivers } = await req.json();\r\n\r\n    if (!companyId) {\r\n      return NextResponse.json(\r\n        { error: 'Invalid company ID' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // 1️⃣ Update company context\r\n    const { error: companyError } =\r\n      await supabaseAdmin\r\n        .from('companies')\r\n        .update({\r\n          company_context: company_context || '',\r\n        })\r\n        .eq('id', companyId);\r\n\r\n    if (companyError) {\r\n      throw new Error(companyError.message);\r\n    }\r\n\r\n    // 2️⃣ Delete existing drivers\r\n    const { error: deleteError } =\r\n      await supabaseAdmin\r\n        .from('drivers')\r\n        .delete()\r\n        .eq('company_id', companyId);\r\n\r\n    if (deleteError) {\r\n      throw new Error(deleteError.message);\r\n    }\r\n\r\n    // 3️⃣ Insert new drivers\r\n    if (Array.isArray(drivers) && drivers.length > 0) {\r\n      const insertPayload = drivers\r\n        .filter((d: any) => d.driver?.trim())\r\n        .map((d: any) => ({\r\n          company_id: companyId,\r\n          driver: d.driver,\r\n        }));\r\n\r\n      if (insertPayload.length > 0) {\r\n        const { error: insertError } =\r\n          await supabaseAdmin\r\n            .from('drivers')\r\n            .insert(insertPayload);\r\n\r\n        if (insertError) {\r\n          throw new Error(insertError.message);\r\n        }\r\n      }\r\n    }\r\n\r\n    return NextResponse.json({ success: true });\r\n  } catch (err: any) {\r\n    return NextResponse.json(\r\n      { error: err.message || 'Failed to update company' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAKO,eAAe,IACpB,IAAa,EACb,OAA4C;IAE5C,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM,QAAQ,MAAM,EAAE,QAAQ;IAC7C,MAAM,YAAY,OAAO;IAEzB,IAAI,CAAC,WAAW;QACd,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAqB,GAC9B;YAAE,QAAQ;QAAI;IAElB;IAEA,oBAAoB;IACpB,MAAM,EAAE,MAAM,OAAO,EAAE,OAAO,YAAY,EAAE,GAC1C,MAAM,kJAAa,CAChB,IAAI,CAAC,aACL,MAAM,CAAC,uBACP,EAAE,CAAC,MAAM,WACT,MAAM;IAEX,IAAI,cAAc;QAChB,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO,aAAa,OAAO;QAAC,GAC9B;YAAE,QAAQ;QAAI;IAElB;IAEA,oBAAoB;IACpB,MAAM,EAAE,MAAM,OAAO,EAAE,OAAO,YAAY,EAAE,GAC1C,MAAM,kJAAa,CAChB,IAAI,CAAC,WACL,MAAM,CAAC,cACP,EAAE,CAAC,cAAc;IAEtB,IAAI,cAAc;QAChB,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO,aAAa,OAAO;QAAC,GAC9B;YAAE,QAAQ;QAAI;IAElB;IAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;QACvB;QACA;IACF;AACF;AAKO,eAAe,IACpB,GAAY,EACZ,OAA4C;IAE5C,IAAI;QACF,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM,QAAQ,MAAM,EAAE,QAAQ;QAC7C,MAAM,YAAY,OAAO;QACzB,MAAM,EAAE,eAAe,EAAE,OAAO,EAAE,GAAG,MAAM,IAAI,IAAI;QAEnD,IAAI,CAAC,WAAW;YACd,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAqB,GAC9B;gBAAE,QAAQ;YAAI;QAElB;QAEA,6BAA6B;QAC7B,MAAM,EAAE,OAAO,YAAY,EAAE,GAC3B,MAAM,kJAAa,CAChB,IAAI,CAAC,aACL,MAAM,CAAC;YACN,iBAAiB,mBAAmB;QACtC,GACC,EAAE,CAAC,MAAM;QAEd,IAAI,cAAc;YAChB,MAAM,IAAI,MAAM,aAAa,OAAO;QACtC;QAEA,8BAA8B;QAC9B,MAAM,EAAE,OAAO,WAAW,EAAE,GAC1B,MAAM,kJAAa,CAChB,IAAI,CAAC,WACL,MAAM,GACN,EAAE,CAAC,cAAc;QAEtB,IAAI,aAAa;YACf,MAAM,IAAI,MAAM,YAAY,OAAO;QACrC;QAEA,yBAAyB;QACzB,IAAI,MAAM,OAAO,CAAC,YAAY,QAAQ,MAAM,GAAG,GAAG;YAChD,MAAM,gBAAgB,QACnB,MAAM,CAAC,CAAC,IAAW,EAAE,MAAM,EAAE,QAC7B,GAAG,CAAC,CAAC,IAAW,CAAC;oBAChB,YAAY;oBACZ,QAAQ,EAAE,MAAM;gBAClB,CAAC;YAEH,IAAI,cAAc,MAAM,GAAG,GAAG;gBAC5B,MAAM,EAAE,OAAO,WAAW,EAAE,GAC1B,MAAM,kJAAa,CAChB,IAAI,CAAC,WACL,MAAM,CAAC;gBAEZ,IAAI,aAAa;oBACf,MAAM,IAAI,MAAM,YAAY,OAAO;gBACrC;YACF;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAK;IAC3C,EAAE,OAAO,KAAU;QACjB,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO,IAAI,OAAO,IAAI;QAA2B,GACnD;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}