{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Desktop/Rohit%20Workspace/Product-%20YI/supabase-saas/src/app/manager/dashboard/page.tsx"],"sourcesContent":["'use client';\r\n\r\nimport Link from 'next/link';\r\nimport { useEffect, useState } from 'react';\r\n\r\ntype Company = {\r\n  id: number;\r\n  company_name: string;\r\n  created_at: string;\r\n  user: string;\r\n};\r\n\r\nexport default function ManagerDashboard() {\r\n  const [companies, setCompanies] = useState<Company[]>([]);\r\n  const [profiles, setProfiles] = useState<Record<string, string>>({});\r\n  const [loading, setLoading] = useState(true);\r\n  const [researchLoading, setResearchLoading] = useState<\r\n    Record<number, boolean>\r\n  >({});\r\n\r\n  useEffect(() => {\r\n    fetchCompanies();\r\n  }, []);\r\n\r\n  const fetchCompanies = async () => {\r\n    setLoading(true);\r\n\r\n    try {\r\n      const res = await fetch('/api/manager/companies');\r\n      const data = await res.json();\r\n\r\n      if (!res.ok) {\r\n        throw new Error(data.error || 'Failed to fetch companies');\r\n      }\r\n\r\n      setCompanies(data.companies || []);\r\n      setProfiles(data.profiles || {});\r\n    } catch (err) {\r\n      console.error('Dashboard error:', err);\r\n    }\r\n\r\n    setLoading(false);\r\n  };\r\n\r\n  const startResearch = async (companyId: number) => {\r\n    setResearchLoading((prev) => ({\r\n      ...prev,\r\n      [companyId]: true,\r\n    }));\r\n\r\n    try {\r\n      const res = await fetch(\r\n        `/api/manager/companies/${companyId}/start-research`,\r\n        {\r\n          method: 'POST',\r\n        }\r\n      );\r\n\r\n      const data = await res.json();\r\n\r\n      if (!res.ok) {\r\n        throw new Error(data.error || 'Failed to start research');\r\n      }\r\n\r\n      // Optional: toast / console log\r\n      console.log('Research started for company', companyId);\r\n    } catch (err) {\r\n      console.error('Research error:', err);\r\n    } finally {\r\n      setResearchLoading((prev) => ({\r\n        ...prev,\r\n        [companyId]: false,\r\n      }));\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-100\">\r\n      {/* Header */}\r\n      <header className=\"relative z-50 bg-black text-yellow-400 px-6 py-4 flex justify-between items-center\">\r\n        <h1 className=\"text-xl font-semibold\">Manager Portal</h1>\r\n\r\n        <Link href=\"/manager/clients/new\">\r\n          <button className=\"bg-yellow-400 text-black px-4 py-2 rounded-md text-sm font-medium hover:bg-yellow-300\">\r\n            + Add Client\r\n          </button>\r\n        </Link>\r\n      </header>\r\n\r\n      {/* Content */}\r\n      <main className=\"p-6 max-w-7xl mx-auto\">\r\n        <h2 className=\"text-lg font-semibold mb-4\">Client Companies</h2>\r\n\r\n        <div className=\"bg-white rounded-lg shadow border overflow-x-auto\">\r\n          <table className=\"w-full text-sm\">\r\n            <thead className=\"bg-gray-50 border-b\">\r\n              <tr>\r\n                <th className=\"px-4 py-3 text-left\">Company</th>\r\n                <th className=\"px-4 py-3 text-left\">Client Name</th>\r\n                <th className=\"px-4 py-3 text-left\">Created</th>\r\n                <th className=\"px-4 py-3 text-right\">Update</th>\r\n                <th className=\"px-4 py-3 text-right\">Research</th>\r\n              </tr>\r\n            </thead>\r\n\r\n            <tbody>\r\n              {companies.map((company) => {\r\n                const isResearching =\r\n                  researchLoading[company.id] === true;\r\n\r\n                return (\r\n                  <tr\r\n                    key={company.id}\r\n                    className=\"border-t hover:bg-gray-50\"\r\n                  >\r\n                    <td className=\"px-4 py-3 font-medium\">\r\n                      {company.company_name}\r\n                    </td>\r\n\r\n                    <td className=\"px-4 py-3 text-gray-700\">\r\n                      {profiles[company.user] || '—'}\r\n                    </td>\r\n\r\n                    <td className=\"px-4 py-3 text-gray-500\">\r\n                      {new Date(\r\n                        company.created_at\r\n                      ).toLocaleDateString()}\r\n                    </td>\r\n\r\n                    {/* Update Context */}\r\n                    <td className=\"px-4 py-3 text-right\">\r\n                      <Link\r\n                        href={`/manager/companies/${company.id}/edit`}\r\n                      >\r\n                        <button\r\n                          type=\"button\"\r\n                          className=\"inline-flex items-center rounded-md bg-black px-3 py-1.5 text-sm font-medium text-yellow-400 hover:bg-gray-900\"\r\n                        >\r\n                          Update Context\r\n                        </button>\r\n                      </Link>\r\n                    </td>\r\n\r\n                    {/* Start Research */}\r\n                    <td className=\"px-4 py-3 text-right\">\r\n                      <button\r\n                        type=\"button\"\r\n                        disabled={isResearching}\r\n                        onClick={() =>\r\n                          startResearch(company.id)\r\n                        }\r\n                        className=\"inline-flex items-center rounded-md bg-yellow-400 px-3 py-1.5 text-sm font-medium text-black hover:bg-yellow-300 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                      >\r\n                        {isResearching\r\n                          ? 'Starting…'\r\n                          : 'Start Research'}\r\n                      </button>\r\n                    </td>\r\n                  </tr>\r\n                );\r\n              })}\r\n\r\n              {!loading && companies.length === 0 && (\r\n                <tr>\r\n                  <td\r\n                    colSpan={5}\r\n                    className=\"px-4 py-6 text-center text-gray-500\"\r\n                  >\r\n                    No client companies found\r\n                  </td>\r\n                </tr>\r\n              )}\r\n\r\n              {loading && (\r\n                <tr>\r\n                  <td\r\n                    colSpan={5}\r\n                    className=\"px-4 py-6 text-center text-gray-400\"\r\n                  >\r\n                    Loading companies…\r\n                  </td>\r\n                </tr>\r\n              )}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      </main>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}