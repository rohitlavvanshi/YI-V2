{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Desktop/Rohit%20Workspace/Product-%20YI/supabase-saas/src/lib/supabase/admin.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js';\r\n\r\nexport const supabaseAdmin = createClient(\r\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n  process.env.SUPABASE_SERVICE_ROLE_KEY!\r\n);\r\n"],"names":[],"mappings":";;;;AAAA;;AAEO,MAAM,gBAAgB,IAAA,gMAAY,gFAEvC,QAAQ,GAAG,CAAC,yBAAyB"}},
    {"offset": {"line": 57, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Desktop/Rohit%20Workspace/Product-%20YI/supabase-saas/src/lib/llm/callLLM.ts"],"sourcesContent":["import OpenAI from 'openai';\r\n\r\nif (!process.env.OPENAI_API_KEY) {\r\n  throw new Error('OPENAI_API_KEY is missing');\r\n}\r\n\r\nconst client = new OpenAI({\r\n  apiKey: process.env.OPENAI_API_KEY,\r\n});\r\n\r\nexport async function callLLM(prompt: string): Promise<string> {\r\n  const res = await client.chat.completions.create({\r\n    model: 'gpt-4o-mini',\r\n    messages: [{ role: 'user', content: prompt }],\r\n    temperature: 0,\r\n  });\r\n\r\n  return res.choices[0].message.content || '';\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AAAA;;AAEA,IAAI,CAAC,QAAQ,GAAG,CAAC,cAAc,EAAE;IAC/B,MAAM,IAAI,MAAM;AAClB;AAEA,MAAM,SAAS,IAAI,mLAAM,CAAC;IACxB,QAAQ,QAAQ,GAAG,CAAC,cAAc;AACpC;AAEO,eAAe,QAAQ,MAAc;IAC1C,MAAM,MAAM,MAAM,OAAO,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC;QAC/C,OAAO;QACP,UAAU;YAAC;gBAAE,MAAM;gBAAQ,SAAS;YAAO;SAAE;QAC7C,aAAa;IACf;IAEA,OAAO,IAAI,OAAO,CAAC,EAAE,CAAC,OAAO,CAAC,OAAO,IAAI;AAC3C"}},
    {"offset": {"line": 87, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Desktop/Rohit%20Workspace/Product-%20YI/supabase-saas/src/lib/prompts/loadPrompts.ts"],"sourcesContent":["export function loadPrompts() {\r\n  return {\r\n    PROMPT_BUILDER_INSTRUCTIONS: `\r\nYou are a senior market intelligence analyst.\r\nFollow instructions strictly.\r\nNever hallucinate.\r\n`,\r\n    ARTICLE_EVALUATION_INSTRUCTIONS: `\r\nFocus only on external market signals.\r\nDo not speculate.\r\n`,\r\n  };\r\n}\r\n"],"names":[],"mappings":";;;;AAAO,SAAS;IACd,OAAO;QACL,6BAA6B,CAAC;;;;AAIlC,CAAC;QACG,iCAAiC,CAAC;;;AAGtC,CAAC;IACC;AACF"}},
    {"offset": {"line": 108, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Desktop/Rohit%20Workspace/Product-%20YI/supabase-saas/src/lib/prompts/schemas.ts"],"sourcesContent":["export const QUERY_GENERATION_SCHEMA = `\r\n{\r\n  \"queries\": [\r\n    \"string\",\r\n    \"string\"\r\n  ]\r\n}\r\n`;\r\n"],"names":[],"mappings":";;;;AAAO,MAAM,0BAA0B,CAAC;;;;;;;AAOxC,CAAC"}},
    {"offset": {"line": 124, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Desktop/Rohit%20Workspace/Product-%20YI/supabase-saas/src/lib/research/queryGenerator.ts"],"sourcesContent":["import { callLLM } from '@/lib/llm/callLLM';\r\nimport { loadPrompts } from '@/lib/prompts/loadPrompts';\r\nimport { QUERY_GENERATION_SCHEMA } from '@/lib/prompts/schemas';\r\n\r\nconst EXPECTED_QUERY_COUNT = 12;\r\n\r\nexport async function generateQueriesForDriver({\r\n  companyContext,\r\n  metric,\r\n  driver,\r\n}: {\r\n  companyContext: string;\r\n  metric: string;\r\n  driver: string;\r\n}): Promise<string[]> {\r\n  const prompts = loadPrompts();\r\n  const instructions = prompts.PROMPT_BUILDER_INSTRUCTIONS;\r\n\r\n  const prompt = `\r\n${instructions}\r\n\r\nGenerate EXACTLY ${EXPECTED_QUERY_COUNT} real-world external search queries.\r\n\r\nCompany Context:\r\n${companyContext}\r\n\r\nMetric:\r\n${metric}\r\n\r\nDriver:\r\n${driver}\r\n\r\nOUTPUT FORMAT (STRICT JSON ONLY):\r\n${QUERY_GENERATION_SCHEMA}\r\n`.trim();\r\n\r\n  const raw = await callLLM(prompt);\r\n\r\n  const parsed = JSON.parse(raw);\r\n  const queries: string[] = parsed?.queries || [];\r\n\r\n  if (queries.length !== EXPECTED_QUERY_COUNT) {\r\n    throw new Error(\r\n      `Driver \"${driver}\" must have exactly ${EXPECTED_QUERY_COUNT} queries`\r\n    );\r\n  }\r\n\r\n  return queries.map((q) => q.trim());\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEA,MAAM,uBAAuB;AAEtB,eAAe,yBAAyB,EAC7C,cAAc,EACd,MAAM,EACN,MAAM,EAKP;IACC,MAAM,UAAU,IAAA,qJAAW;IAC3B,MAAM,eAAe,QAAQ,2BAA2B;IAExD,MAAM,SAAS,CAAC;AAClB,EAAE,aAAa;;iBAEE,EAAE,qBAAqB;;;AAGxC,EAAE,eAAe;;;AAGjB,EAAE,OAAO;;;AAGT,EAAE,OAAO;;;AAGT,EAAE,6JAAuB,CAAC;AAC1B,CAAC,CAAC,IAAI;IAEJ,MAAM,MAAM,MAAM,IAAA,yIAAO,EAAC;IAE1B,MAAM,SAAS,KAAK,KAAK,CAAC;IAC1B,MAAM,UAAoB,QAAQ,WAAW,EAAE;IAE/C,IAAI,QAAQ,MAAM,KAAK,sBAAsB;QAC3C,MAAM,IAAI,MACR,CAAC,QAAQ,EAAE,OAAO,oBAAoB,EAAE,qBAAqB,QAAQ,CAAC;IAE1E;IAEA,OAAO,QAAQ,GAAG,CAAC,CAAC,IAAM,EAAE,IAAI;AAClC"}},
    {"offset": {"line": 167, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Desktop/Rohit%20Workspace/Product-%20YI/supabase-saas/src/lib/search/braveClient.ts"],"sourcesContent":["export async function searchBrave(\r\n  query: string,\r\n  days: number\r\n) {\r\n  const apiKey = process.env.BRAVE_API_KEY;\r\n  if (!apiKey) throw new Error('BRAVE_API_KEY missing');\r\n\r\n  const params = new URLSearchParams({\r\n    q: query,\r\n    recency: days.toString(),\r\n  });\r\n\r\n  const res = await fetch(\r\n    `https://api.search.brave.com/res/v1/news/search?${params}`,\r\n    {\r\n      headers: {\r\n        'X-Subscription-Token': apiKey,\r\n        Accept: 'application/json',\r\n      },\r\n    }\r\n  );\r\n\r\n  const json = await res.json();\r\n  return json?.results || [];\r\n}\r\n"],"names":[],"mappings":";;;;AAAO,eAAe,YACpB,KAAa,EACb,IAAY;IAEZ,MAAM,SAAS,QAAQ,GAAG,CAAC,aAAa;IACxC,IAAI,CAAC,QAAQ,MAAM,IAAI,MAAM;IAE7B,MAAM,SAAS,IAAI,gBAAgB;QACjC,GAAG;QACH,SAAS,KAAK,QAAQ;IACxB;IAEA,MAAM,MAAM,MAAM,MAChB,CAAC,gDAAgD,EAAE,QAAQ,EAC3D;QACE,SAAS;YACP,wBAAwB;YACxB,QAAQ;QACV;IACF;IAGF,MAAM,OAAO,MAAM,IAAI,IAAI;IAC3B,OAAO,MAAM,WAAW,EAAE;AAC5B"}},
    {"offset": {"line": 191, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Desktop/Rohit%20Workspace/Product-%20YI/supabase-saas/src/lib/search/searchExecutor.ts"],"sourcesContent":["import { searchBrave } from '@/lib/search/braveClient';\r\n\r\nexport async function runSearch(\r\n  queriesByDriver: Record<string, string[]>,\r\n  days: number\r\n) {\r\n  const allResults: any = {};\r\n\r\n  for (const [driver, queries] of Object.entries(queriesByDriver)) {\r\n    if (queries.length !== 12) {\r\n      throw new Error(`Driver \"${driver}\" must have 12 queries`);\r\n    }\r\n\r\n    const driverResults: any = {};\r\n\r\n    for (const query of queries) {\r\n      driverResults[query] = await searchBrave(query, days);\r\n    }\r\n\r\n    allResults[driver] = driverResults;\r\n  }\r\n\r\n  return allResults;\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AAEO,eAAe,UACpB,eAAyC,EACzC,IAAY;IAEZ,MAAM,aAAkB,CAAC;IAEzB,KAAK,MAAM,CAAC,QAAQ,QAAQ,IAAI,OAAO,OAAO,CAAC,iBAAkB;QAC/D,IAAI,QAAQ,MAAM,KAAK,IAAI;YACzB,MAAM,IAAI,MAAM,CAAC,QAAQ,EAAE,OAAO,sBAAsB,CAAC;QAC3D;QAEA,MAAM,gBAAqB,CAAC;QAE5B,KAAK,MAAM,SAAS,QAAS;YAC3B,aAAa,CAAC,MAAM,GAAG,MAAM,IAAA,oJAAW,EAAC,OAAO;QAClD;QAEA,UAAU,CAAC,OAAO,GAAG;IACvB;IAEA,OAAO;AACT"}},
    {"offset": {"line": 215, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Desktop/Rohit%20Workspace/Product-%20YI/supabase-saas/src/lib/llm/safeJsonParse.ts"],"sourcesContent":["export function safeJsonParse(text: string): any {\r\n  if (!text) throw new Error('Empty LLM response');\r\n\r\n  let cleaned = text.trim();\r\n\r\n  if (cleaned.startsWith('```')) {\r\n    cleaned = cleaned.replace(/```json|```/g, '').trim();\r\n  }\r\n\r\n  try {\r\n    return JSON.parse(cleaned);\r\n  } catch {\r\n    const start = cleaned.indexOf('{');\r\n    const end = cleaned.lastIndexOf('}');\r\n    if (start !== -1 && end !== -1) {\r\n      return JSON.parse(cleaned.slice(start, end + 1));\r\n    }\r\n  }\r\n\r\n  throw new Error('Invalid JSON returned by LLM');\r\n}\r\n"],"names":[],"mappings":";;;;AAAO,SAAS,cAAc,IAAY;IACxC,IAAI,CAAC,MAAM,MAAM,IAAI,MAAM;IAE3B,IAAI,UAAU,KAAK,IAAI;IAEvB,IAAI,QAAQ,UAAU,CAAC,QAAQ;QAC7B,UAAU,QAAQ,OAAO,CAAC,gBAAgB,IAAI,IAAI;IACpD;IAEA,IAAI;QACF,OAAO,KAAK,KAAK,CAAC;IACpB,EAAE,OAAM;QACN,MAAM,QAAQ,QAAQ,OAAO,CAAC;QAC9B,MAAM,MAAM,QAAQ,WAAW,CAAC;QAChC,IAAI,UAAU,CAAC,KAAK,QAAQ,CAAC,GAAG;YAC9B,OAAO,KAAK,KAAK,CAAC,QAAQ,KAAK,CAAC,OAAO,MAAM;QAC/C;IACF;IAEA,MAAM,IAAI,MAAM;AAClB"}},
    {"offset": {"line": 240, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Desktop/Rohit%20Workspace/Product-%20YI/supabase-saas/src/lib/research/evaluateArticle.ts"],"sourcesContent":["import { callLLM } from '@/lib/llm/callLLM';\r\nimport { safeJsonParse } from '@/lib/llm/safeJsonParse';\r\nimport { loadPrompts } from '@/lib/prompts/loadPrompts';\r\n\r\nconst MAX_ARTICLE_CHARS = 8000;\r\nconst MIN_ARTICLE_CHARS = 500;\r\n\r\nexport async function evaluateArticle({\r\n  article,\r\n  context,\r\n  metric,\r\n  driver,\r\n}: {\r\n  article: string;\r\n  context: string;\r\n  metric: string;\r\n  driver: string;\r\n}) {\r\n  // ðŸš« Skip junk articles\r\n  if (!article || article.length < MIN_ARTICLE_CHARS) {\r\n    return {\r\n      score: 1,\r\n      summary:\r\n        'Article content unavailable or insufficient for reliable evaluation.',\r\n    };\r\n  }\r\n\r\n  const prompts = loadPrompts();\r\n  const userInstruction =\r\n    prompts.ARTICLE_EVALUATION_INSTRUCTIONS || '';\r\n\r\n  const systemPrompt = `\r\nYou are an expert equity research and market intelligence analyst.\r\n\r\nYou must evaluate the article strictly as an EXTERNAL SIGNAL.\r\n\r\nContext:\r\n${context}\r\n\r\nTarget Metric:\r\n${metric}\r\n\r\nDriver:\r\n${driver}\r\n\r\nArticle Content:\r\n\"\"\"\r\n${article.slice(0, MAX_ARTICLE_CHARS)}\r\n\"\"\"\r\n\r\nEvaluation Rules:\r\n- Assign a relevance score from 1 to 5\r\n- Score reflects how strongly the article indicates movement in the metric via the driver\r\n- Generate a concise executive summary (max 3 sentences)\r\n- Do NOT speculate or add external knowledge\r\n- Base judgment ONLY on the article\r\n\r\nUser Guidance:\r\n${userInstruction}\r\n\r\nOUTPUT FORMAT (STRICT JSON ONLY):\r\n{\r\n  \"score\": <integer 1-5>,\r\n  \"summary\": \"<short summary>\"\r\n}\r\n`.trim();\r\n\r\n  try {\r\n    const raw = await callLLM(systemPrompt);\r\n    const parsed = safeJsonParse(raw);\r\n\r\n    const score = Math.min(\r\n      Math.max(Number(parsed.score) || 1, 1),\r\n      5\r\n    );\r\n\r\n    const summary =\r\n      typeof parsed.summary === 'string' && parsed.summary.trim()\r\n        ? parsed.summary.trim()\r\n        : 'No summary returned.';\r\n\r\n    return { score, summary };\r\n  } catch (err) {\r\n    console.error('Article evaluation failed:', err);\r\n\r\n    // âœ… Never crash pipeline\r\n    return {\r\n      score: 1,\r\n      summary: 'Article could not be reliably evaluated.',\r\n    };\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEA,MAAM,oBAAoB;AAC1B,MAAM,oBAAoB;AAEnB,eAAe,gBAAgB,EACpC,OAAO,EACP,OAAO,EACP,MAAM,EACN,MAAM,EAMP;IACC,wBAAwB;IACxB,IAAI,CAAC,WAAW,QAAQ,MAAM,GAAG,mBAAmB;QAClD,OAAO;YACL,OAAO;YACP,SACE;QACJ;IACF;IAEA,MAAM,UAAU,IAAA,qJAAW;IAC3B,MAAM,kBACJ,QAAQ,+BAA+B,IAAI;IAE7C,MAAM,eAAe,CAAC;;;;;;AAMxB,EAAE,QAAQ;;;AAGV,EAAE,OAAO;;;AAGT,EAAE,OAAO;;;;AAIT,EAAE,QAAQ,KAAK,CAAC,GAAG,mBAAmB;;;;;;;;;;;AAWtC,EAAE,gBAAgB;;;;;;;AAOlB,CAAC,CAAC,IAAI;IAEJ,IAAI;QACF,MAAM,MAAM,MAAM,IAAA,yIAAO,EAAC;QAC1B,MAAM,SAAS,IAAA,qJAAa,EAAC;QAE7B,MAAM,QAAQ,KAAK,GAAG,CACpB,KAAK,GAAG,CAAC,OAAO,OAAO,KAAK,KAAK,GAAG,IACpC;QAGF,MAAM,UACJ,OAAO,OAAO,OAAO,KAAK,YAAY,OAAO,OAAO,CAAC,IAAI,KACrD,OAAO,OAAO,CAAC,IAAI,KACnB;QAEN,OAAO;YAAE;YAAO;QAAQ;IAC1B,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,8BAA8B;QAE5C,yBAAyB;QACzB,OAAO;YACL,OAAO;YACP,SAAS;QACX;IACF;AACF"}},
    {"offset": {"line": 319, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Desktop/Rohit%20Workspace/Product-%20YI/supabase-saas/src/lib/research/processArticles.ts"],"sourcesContent":["import { supabaseAdmin } from '@/lib/supabase/admin';\r\nimport { evaluateArticle } from './evaluateArticle';\r\n\r\ntype SearchArticle = {\r\n  title: string;\r\n  url: string;\r\n  description?: string;\r\n};\r\n\r\ntype SearchResultsByDriver = Record<\r\n  string,\r\n  Record<string, SearchArticle[]>\r\n>;\r\n\r\nexport async function processAndStoreArticles({\r\n  companyId,\r\n  context,\r\n  metric,\r\n  searchResults,\r\n}: {\r\n  companyId: number;\r\n  context: string;\r\n  metric: string;\r\n  searchResults: SearchResultsByDriver;\r\n}) {\r\n  for (const [driver, queriesByQuery] of Object.entries(searchResults)) {\r\n    for (const articles of Object.values(queriesByQuery)) {\r\n      for (const article of articles) {\r\n        const rawContent = article.description?.trim() || '';\r\n\r\n        // ðŸš« Skip empty / weak articles\r\n        if (!rawContent) continue;\r\n\r\n        // âœ… CORRECT CALL â€” NO `query`\r\n        const evaluation = await evaluateArticle({\r\n          article: rawContent,\r\n          context,\r\n          metric,\r\n          driver,\r\n        });\r\n\r\n        // ðŸš« Only store strong signals\r\n        if (evaluation.score < 4) continue;\r\n\r\n        await supabaseAdmin.from('articles').insert({\r\n          company_id: companyId,\r\n          title: article.title,\r\n          url: article.url,\r\n          snippet: article.description || '',\r\n          article_content: rawContent,\r\n          summary: evaluation.summary,\r\n          score: evaluation.score,\r\n          driver: Number(driver),\r\n        });\r\n      }\r\n    }\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAaO,eAAe,wBAAwB,EAC5C,SAAS,EACT,OAAO,EACP,MAAM,EACN,aAAa,EAMd;IACC,KAAK,MAAM,CAAC,QAAQ,eAAe,IAAI,OAAO,OAAO,CAAC,eAAgB;QACpE,KAAK,MAAM,YAAY,OAAO,MAAM,CAAC,gBAAiB;YACpD,KAAK,MAAM,WAAW,SAAU;gBAC9B,MAAM,aAAa,QAAQ,WAAW,EAAE,UAAU;gBAElD,gCAAgC;gBAChC,IAAI,CAAC,YAAY;gBAEjB,8BAA8B;gBAC9B,MAAM,aAAa,MAAM,IAAA,8JAAe,EAAC;oBACvC,SAAS;oBACT;oBACA;oBACA;gBACF;gBAEA,+BAA+B;gBAC/B,IAAI,WAAW,KAAK,GAAG,GAAG;gBAE1B,MAAM,kJAAa,CAAC,IAAI,CAAC,YAAY,MAAM,CAAC;oBAC1C,YAAY;oBACZ,OAAO,QAAQ,KAAK;oBACpB,KAAK,QAAQ,GAAG;oBAChB,SAAS,QAAQ,WAAW,IAAI;oBAChC,iBAAiB;oBACjB,SAAS,WAAW,OAAO;oBAC3B,OAAO,WAAW,KAAK;oBACvB,QAAQ,OAAO;gBACjB;YACF;QACF;IACF;AACF"}},
    {"offset": {"line": 361, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Desktop/Rohit%20Workspace/Product-%20YI/supabase-saas/src/lib/research/startCompanyResearch.ts"],"sourcesContent":["import { generateQueriesForDriver } from './queryGenerator';\r\nimport { runSearch } from '@/lib/search/searchExecutor';\r\nimport { processAndStoreArticles } from './processArticles';\r\n\r\nexport async function startCompanyResearch({\r\n  companyId,\r\n  companyContext,\r\n  drivers,\r\n  metric,\r\n}: {\r\n  companyId: number;\r\n  companyContext: string;\r\n  drivers: string[];\r\n  metric: string;\r\n}) {\r\n  const queriesByDriver: any = {};\r\n\r\n  for (const driver of drivers) {\r\n    queriesByDriver[driver] =\r\n      await generateQueriesForDriver({\r\n        companyContext,\r\n        metric,\r\n        driver,\r\n      });\r\n  }\r\n\r\n  const searchResults = await runSearch(queriesByDriver, 30);\r\n\r\n  await processAndStoreArticles({\r\n    companyId,\r\n    context: companyContext,\r\n    metric,\r\n    searchResults,\r\n  });\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEO,eAAe,qBAAqB,EACzC,SAAS,EACT,cAAc,EACd,OAAO,EACP,MAAM,EAMP;IACC,MAAM,kBAAuB,CAAC;IAE9B,KAAK,MAAM,UAAU,QAAS;QAC5B,eAAe,CAAC,OAAO,GACrB,MAAM,IAAA,sKAAwB,EAAC;YAC7B;YACA;YACA;QACF;IACJ;IAEA,MAAM,gBAAgB,MAAM,IAAA,qJAAS,EAAC,iBAAiB;IAEvD,MAAM,IAAA,sKAAuB,EAAC;QAC5B;QACA,SAAS;QACT;QACA;IACF;AACF"}},
    {"offset": {"line": 392, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Desktop/Rohit%20Workspace/Product-%20YI/supabase-saas/src/app/api/manager/companies/%5Bid%5D/start-research/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport { supabaseAdmin } from '@/lib/supabase/admin';\r\nimport { startCompanyResearch } from '@/lib/research/startCompanyResearch';\r\n\r\nexport async function POST(\r\n  _req: Request,\r\n  context: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    const { id } = await context.params;\r\n    const companyId = Number(id);\r\n\r\n    if (!companyId) {\r\n      return NextResponse.json(\r\n        { error: 'Invalid company ID' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // 1ï¸âƒ£ Fetch company context\r\n    const { data: company, error: companyError } =\r\n      await supabaseAdmin\r\n        .from('companies')\r\n        .select('company_context')\r\n        .eq('id', companyId)\r\n        .single();\r\n\r\n    if (companyError || !company) {\r\n      return NextResponse.json(\r\n        { error: 'Company not found' },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    if (!company.company_context) {\r\n      return NextResponse.json(\r\n        { error: 'Company context is missing' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // 2ï¸âƒ£ Fetch drivers\r\n    const { data: drivers, error: driversError } =\r\n      await supabaseAdmin\r\n        .from('drivers')\r\n        .select('driver')\r\n        .eq('company_id', companyId);\r\n\r\n    if (driversError || !drivers || drivers.length === 0) {\r\n      return NextResponse.json(\r\n        { error: 'No drivers found for company' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // 3ï¸âƒ£ Start research\r\n    await startCompanyResearch({\r\n      companyId,\r\n      companyContext: company.company_context,\r\n      drivers: drivers.map((d) => String(d.driver)),\r\n      metric: 'Revenue Growth',\r\n    });\r\n\r\n    return NextResponse.json({ success: true });\r\n  } catch (err: any) {\r\n    console.error('Start research failed:', err);\r\n\r\n    return NextResponse.json(\r\n      { error: err.message || 'Failed to start research' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEO,eAAe,KACpB,IAAa,EACb,OAA4C;IAE5C,IAAI;QACF,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM,QAAQ,MAAM;QACnC,MAAM,YAAY,OAAO;QAEzB,IAAI,CAAC,WAAW;YACd,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAqB,GAC9B;gBAAE,QAAQ;YAAI;QAElB;QAEA,4BAA4B;QAC5B,MAAM,EAAE,MAAM,OAAO,EAAE,OAAO,YAAY,EAAE,GAC1C,MAAM,kJAAa,CAChB,IAAI,CAAC,aACL,MAAM,CAAC,mBACP,EAAE,CAAC,MAAM,WACT,MAAM;QAEX,IAAI,gBAAgB,CAAC,SAAS;YAC5B,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAoB,GAC7B;gBAAE,QAAQ;YAAI;QAElB;QAEA,IAAI,CAAC,QAAQ,eAAe,EAAE;YAC5B,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA6B,GACtC;gBAAE,QAAQ;YAAI;QAElB;QAEA,oBAAoB;QACpB,MAAM,EAAE,MAAM,OAAO,EAAE,OAAO,YAAY,EAAE,GAC1C,MAAM,kJAAa,CAChB,IAAI,CAAC,WACL,MAAM,CAAC,UACP,EAAE,CAAC,cAAc;QAEtB,IAAI,gBAAgB,CAAC,WAAW,QAAQ,MAAM,KAAK,GAAG;YACpD,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA+B,GACxC;gBAAE,QAAQ;YAAI;QAElB;QAEA,qBAAqB;QACrB,MAAM,IAAA,wKAAoB,EAAC;YACzB;YACA,gBAAgB,QAAQ,eAAe;YACvC,SAAS,QAAQ,GAAG,CAAC,CAAC,IAAM,OAAO,EAAE,MAAM;YAC3C,QAAQ;QACV;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAK;IAC3C,EAAE,OAAO,KAAU;QACjB,QAAQ,KAAK,CAAC,0BAA0B;QAExC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO,IAAI,OAAO,IAAI;QAA2B,GACnD;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}